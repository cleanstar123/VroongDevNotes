# 2026-02-10 ê°œë°œ ì¼ì§€

#daily #vroong

---

## ğŸ“Š ì˜¤ëŠ˜ ì‘ì—… ìš”ì•½

| ì‘ì—…                      | ìƒíƒœ  | ë¶„ë¥˜       |
| ----------------------- | :-: | -------- |
| MacroDroid ë°°ë¯¼ ì„¸ì…˜ ìë™ ì¬ì¸ì¦ |  âœ…  | Backend  |
| ë¼ì´ë” ì¶œê¸ˆì œí•œ ë°°ì¹˜ ë¡œì§ ì œê±°       |  âœ…  | Backend  |
| ì •ì‚°ì„œ ì¤‘ë³µ ì—…ë¡œë“œ ì—ëŸ¬ ë©”ì‹œì§€ ê°œì„     |  âœ…  | Backend  |
| í”„ë¡ íŠ¸ì—”ë“œ ì—ëŸ¬ ë©”ì‹œì§€ ë²„ê·¸ ìˆ˜ì •      |  âœ…  | Frontend |
| ëŒ€ì‹œë³´ë“œ í”„ë¡œì‹œì € í†µí•© (4â†’1)      |  âœ…  | Backend  |
| ë³¸ì‚¬ ìˆ˜ìˆ˜ë£Œ N+1 ë¬¸ì œ í•´ê²°        |  âœ…  | Backend  |

---

## 1. MacroDroidë¥¼ í™œìš©í•œ ë°°ë¯¼ ì„¸ì…˜ ìë™ ì¬ì¸ì¦

> [!info] ë°°ê²½
> - ë°°ë¯¼ ì…€ëŸ¬ ì„¸ì…˜ì´ ë§Œë£Œë˜ë©´ ìˆ˜ë™ìœ¼ë¡œ ë¡œê·¸ì¸ + 2FA ì¸ì¦ í•„ìš”
> - relay-serverì—ì„œ Puppeteerë¡œ ìë™ ë¡œê·¸ì¸ êµ¬í˜„í–ˆìœ¼ë‚˜, SMS ì¸ì¦ì½”ë“œ ì…ë ¥ì´ ìˆ˜ë™

> [!warning] ë¬¸ì œ
> - SMS ì¸ì¦ì½”ë“œë¥¼ ì‚¬ëŒì´ ì§ì ‘ í™•ì¸í•´ì„œ APIë¡œ ì „ë‹¬í•´ì•¼ í•¨
> - ì™„ì „ ìë™í™”ê°€ ì•ˆ ë¨

> [!success] í•´ê²°
> - MacroDroid ì•±ìœ¼ë¡œ SMS ìˆ˜ì‹  ì‹œ ìë™ìœ¼ë¡œ ì„œë²„ì— ì „ë‹¬
> - SMS ë©”ì‹œì§€ì—ì„œ 6ìë¦¬ ì¸ì¦ì½”ë“œ ì¶”ì¶œ: `{lv=auth_code}` ë³€ìˆ˜ ì‚¬ìš©
> - GET ë°©ì‹ ì›¹í›… ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€ (`BaeminAuthController.java`)
> ```
> GET /api/v1/baemin/auth/sms-webhook?message={lv=auth_code}
> ```

> [!check] ê²°ê³¼
> ì„¸ì…˜ ë§Œë£Œ â†’ ìë™ ë¡œê·¸ì¸ â†’ SMS ìˆ˜ì‹  â†’ MacroDroid ìë™ ì „ë‹¬ â†’ ì¸ì¦ ì™„ë£Œ
> **58ê°œ í˜‘ë ¥ì‚¬ ì •ìƒ ì¡°íšŒ í™•ì¸** âœ¨

> [!tip] ë°°ìš´ ì 
> - MacroDroid ê°™ì€ ìë™í™” ì•±ìœ¼ë¡œ ëª¨ë°”ì¼-ì„œë²„ ì—°ë™ ê°€ëŠ¥
> - GET ë°©ì‹ ì—”ë“œí¬ì¸íŠ¸ê°€ ì™¸ë¶€ ìë™í™” ë„êµ¬ ì—°ë™ì— ìœ ë¦¬

---

## 2. ë¼ì´ë” ê°œë³„ ì¶œê¸ˆì œí•œ ë°°ì¹˜ ë¡œì§ ì œê±°

> [!info] ë°°ê²½
> ì¶œê¸ˆì œí•œ ì²˜ë¦¬ê°€ 2ê°€ì§€ ì¼€ì´ìŠ¤ë¡œ ë™ì‘ ì¤‘
> 1. í˜‘ë ¥ì‚¬ ì”ì•¡ ìŒìˆ˜ â†’ í˜‘ë ¥ì‚¬ + ì†Œì† ë¼ì´ë” ì „ì²´ ì¶œê¸ˆì œí•œ
> 2. ë¼ì´ë” ê°œë³„ ì”ì•¡ ìŒìˆ˜ â†’ í•´ë‹¹ ë¼ì´ë”ë§Œ ì¶œê¸ˆì œí•œ

> [!warning] ë¬¸ì œ
> - 2ë²ˆ ì¼€ì´ìŠ¤: ë¼ì´ë” ì•±ì—ì„œ ì´ë¯¸ ë§ˆì´ë„ˆìŠ¤ ì”ì•¡ì´ë©´ ì¶œê¸ˆ ë²„íŠ¼ ë¹„í™œì„±í™”ë¨
> - ì„ ì •ì‚°/ì£¼ì •ì‚°ìœ¼ë¡œ ì”ì•¡ì´ ì–‘ìˆ˜ê°€ ë˜ì–´ë„ ë°°ì¹˜ ì „ê¹Œì§€ ì¶œê¸ˆì œí•œ ìœ ì§€

> [!success] í•´ê²°
> - `BatchWithdrawalUseCase.java`ì—ì„œ ë¼ì´ë” ê°œë³„ ì¶œê¸ˆì œí•œ ë¡œì§ ì œê±°
> - ì•±ì—ì„œ ì´ë¯¸ ì²˜ë¦¬í•˜ë¯€ë¡œ ì¤‘ë³µ ë¡œì§ ë¶ˆí•„ìš”

> [!tip] ë°°ìš´ ì 
> - ë™ì¼í•œ ê¸°ëŠ¥ì´ ì—¬ëŸ¬ ê³³ì—ì„œ ì²˜ë¦¬ë˜ë©´ **íƒ€ì´ë° ì´ìŠˆ** ë°œìƒ ê°€ëŠ¥
> - í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì´ë¯¸ ì²˜ë¦¬í•˜ëŠ” ë¡œì§ì€ ì„œë²„ì—ì„œ ì¤‘ë³µ ì²˜ë¦¬í•  í•„ìš” ì—†ìŒ

---

## 3. ì •ì‚°ì„œ ì¤‘ë³µ ì—…ë¡œë“œ ì—ëŸ¬ ë©”ì‹œì§€ ê°œì„ 

> [!info] ë°°ê²½
> ê°™ì€ ì •ì‚°ì„œë¥¼ 2ë²ˆ ì—…ë¡œë“œí•˜ë©´ ì‹¤íŒ¨ ì²˜ë¦¬ë¨

> [!warning] ë¬¸ì œ
> - "ì •ì‚°ì„œ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤" ë¼ëŠ” ëª¨í˜¸í•œ ì—ëŸ¬ ë©”ì‹œì§€
> - ì‚¬ìš©ìê°€ ì™œ ì‹¤íŒ¨í–ˆëŠ”ì§€ ì•Œ ìˆ˜ ì—†ìŒ

> [!success] í•´ê²°
> `SettlementUploadUseCase.java` ìˆ˜ì • â†’ êµ¬ì²´ì ì¸ ë©”ì‹œì§€ ë°˜í™˜
>
> **Before:** `ì •ì‚°ì„œ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤`
> **After:** `20260128 ~ 20260203 ì •ì‚°ì„œë¥¼ ì¤‘ë³µ ì—…ë¡œë“œ í•˜ì˜€ìŠµë‹ˆë‹¤.`

> [!example]- ì½”ë“œ ë³´ê¸°
> ```java
> private static final DateTimeFormatter PERIOD_FORMATTER =
>     DateTimeFormatter.ofPattern("yyyyMMdd");
>
> private String formatPeriodForMessage(LocalDate startDate, LocalDate endDate) {
>     String start = startDate != null ? startDate.format(PERIOD_FORMATTER) : "ì•Œìˆ˜ì—†ìŒ";
>     String end = endDate != null ? endDate.format(PERIOD_FORMATTER) : "ì•Œìˆ˜ì—†ìŒ";
>     return start + " ~ " + end;
> }
> ```

---

## 4. í”„ë¡ íŠ¸ì—”ë“œ ì—ëŸ¬ ë©”ì‹œì§€ ë¯¸í‘œì‹œ ë²„ê·¸ ìˆ˜ì •

> [!info] ë°°ê²½
> ë°±ì—”ë“œì—ì„œ êµ¬ì²´ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë„ë¡ ìˆ˜ì • ì™„ë£Œ

> [!bug] ë¬¸ì œ
> í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì—¬ì „íˆ ì¼ë°˜ ë©”ì‹œì§€ í‘œì‹œ
> `"ë¼ì´ë” ì •ì‚°ì„œ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤"`

> [!search] ì›ì¸ ë¶„ì„
> console.log ë””ë²„ê¹…ìœ¼ë¡œ ì—ëŸ¬ ê°ì²´ êµ¬ì¡° í™•ì¸:
> ```
> error ì „ì²´: {name: 'ApiError', message: '20260128 ~ 20260203...', ...}
> axiosError.response: undefined
> ```
> - axios ì¸í„°ì…‰í„°ê°€ ì—ëŸ¬ë¥¼ `ApiError` ê°ì²´ë¡œ ë³€í™˜
> - ê¸°ì¡´ ì½”ë“œëŠ” `error.response.data.message`ë¥¼ ì°¾ìŒ â†’ `undefined`

> [!success] í•´ê²°
> `useSettlementUpload.ts` catch ë¸”ë¡ ìˆ˜ì •
> ```typescript
> // Before
> const errorMessage = axiosError?.response?.data?.message || '...'
>
> // After
> const errorMessage = apiError?.message || apiError?.response?.data?.message || '...'
> ```

> [!tip] ë°°ìš´ ì 
> - axios ì¸í„°ì…‰í„°ê°€ ì—ëŸ¬ë¥¼ ë³€í™˜í•˜ëŠ” ê²½ìš°, ì›ë³¸ ì—ëŸ¬ êµ¬ì¡°ê°€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŒ
> - ë””ë²„ê¹… ì‹œ **ì‹¤ì œ ì—ëŸ¬ ê°ì²´ êµ¬ì¡°**ë¥¼ console.logë¡œ í™•ì¸í•˜ëŠ” ê²ƒì´ ì¤‘ìš”
> - ì—ëŸ¬ ì²˜ë¦¬ ì‹œ ì—¬ëŸ¬ í˜•íƒœì˜ ì—ëŸ¬ ê°ì²´ë¥¼ ê³ ë ¤í•´ì•¼ í•¨

---

## 5. ëŒ€ì‹œë³´ë“œ í”„ë¡œì‹œì € í†µí•© ìµœì í™”

> [!info] ë°°ê²½
> ì£¼ê°„ ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ ì§„ì… ì‹œ 4ê°œì˜ í”„ë¡œì‹œì €ë¥¼ ìˆœì°¨ í˜¸ì¶œ
> - `sp_get_weekly_daily_performance`
> - `sp_get_weekly_supplier_aggregation`
> - `sp_get_supplier_period_performance`
> - `sp_get_supplier_daily_slots`

> [!warning] ë¬¸ì œ
> - 4ë²ˆì˜ DB í˜¸ì¶œë¡œ ì¸í•œ ë„¤íŠ¸ì›Œí¬ ì˜¤ë²„í—¤ë“œ
> - ê° í”„ë¡œì‹œì €ê°€ ë¹„ìŠ·í•œ í…Œì´ë¸”ì„ ì¤‘ë³µ ì¡°íšŒ

> [!success] í•´ê²°
> 4ê°œ í”„ë¡œì‹œì €ë¥¼ 1ê°œë¡œ í†µí•©: `sp_get_weekly_dashboard_all`
> - Multiple Result Sets ë°©ì‹ìœ¼ë¡œ 4ê°œ ê²°ê³¼ì…‹ ë°˜í™˜
> - Javaì—ì„œ `getMoreResults()`ë¡œ ìˆœì°¨ ì²˜ë¦¬
> ```java
> CallableStatement stmt = connection.prepareCall("{CALL sp_get_weekly_dashboard_all(?, ?)}");
> ResultSet rs1 = stmt.getResultSet();  // ì¼ë³„ ì‹¤ì 
> stmt.getMoreResults();
> ResultSet rs2 = stmt.getResultSet();  // í˜‘ë ¥ì‚¬ ì§‘ê³„
> // ...
> ```

> [!check] ê²°ê³¼
> DB í˜¸ì¶œ 4íšŒ â†’ 1íšŒë¡œ ê°ì†Œ

> [!tip] ë°°ìš´ ì 
> - MySQL í”„ë¡œì‹œì €ì—ì„œ ì—¬ëŸ¬ SELECTë¬¸ì„ ì‚¬ìš©í•˜ë©´ Multiple Result Sets ë°˜í™˜
> - Collation ì¶©ëŒ ì‹œ `COLLATE utf8mb4_general_ci` ëª…ì‹œ í•„ìš”

---

## 6. ë³¸ì‚¬ ìˆ˜ìˆ˜ë£Œ í˜ì´ì§€ N+1 ë¬¸ì œ í•´ê²°

> [!info] ë°°ê²½
> ë³¸ì‚¬ ìˆ˜ìˆ˜ë£Œ í˜ì´ì§€ ì§„ì… ì‹œ ëŠë¦° ë¡œë”©
> - `sp_get_all_suppliers` 1íšŒ í˜¸ì¶œ (í˜‘ë ¥ì‚¬ ëª©ë¡)
> - `sp_get_active_commissions_by_supplier` NíšŒ í˜¸ì¶œ (í˜‘ë ¥ì‚¬ë³„ ìˆ˜ìˆ˜ë£Œ)

> [!warning] ë¬¸ì œ
> - 173ê°œ í˜‘ë ¥ì‚¬ Ã— ê°œë³„ ìˆ˜ìˆ˜ë£Œ ì¡°íšŒ = 174ë²ˆ DB í˜¸ì¶œ
> - ì „í˜•ì ì¸ N+1 ë¬¸ì œ

> [!success] í•´ê²°
> í†µí•© í”„ë¡œì‹œì € `sp_get_all_supplier_commissions` ìƒì„±
> - í˜‘ë ¥ì‚¬ ì •ë³´ + ì¼ì •ì‚°/ì£¼ì •ì‚° ìˆ˜ìˆ˜ë£Œë¥¼ JOINìœ¼ë¡œ í•œ ë²ˆì— ì¡°íšŒ
> - Java ë§¤í•‘ ì½”ë“œ ì¶”ê°€ (`FeeMstRepositoryImpl.java`)
> ```java
> @Override
> public CompletableFuture<List<SupplierCommissionDto>> findAllSupplierCommissions() {
>     List<Object[]> results = callAllSupplierCommissionsProcedure();
>     // 43ê°œ ì»¬ëŸ¼ â†’ SupplierCommissionDto ë§¤í•‘
> }
> ```

> [!bug] íŠ¸ëŸ¬ë¸”ìŠˆíŒ…
> 1. **NPE ë°œìƒ**: `toLocalDate()` ê²°ê³¼ê°€ nullì¸ë° `.toString()` í˜¸ì¶œ
>    â†’ null ì²´í¬ í›„ toString() í˜¸ì¶œí•˜ë„ë¡ ìˆ˜ì •
> 2. **ì ìš©ì¼ ë¯¸í‘œì‹œ**: `START_DAY`ê°€ String íƒ€ì…ìœ¼ë¡œ ë°˜í™˜ë¨
>    â†’ `toLocalDate()`ì— String íŒŒì‹± ë¡œì§ ì¶”ê°€
> ```java
> if (value instanceof String str && !str.isEmpty()) {
>     return LocalDate.parse(str);
> }
> ```

> [!check] ê²°ê³¼
> DB í˜¸ì¶œ 174íšŒ â†’ 1íšŒë¡œ ê°ì†Œ, 173ê°œ í˜‘ë ¥ì‚¬ ì •ìƒ ì¡°íšŒ âœ¨

> [!tip] ë°°ìš´ ì 
> - í”„ë¡œì‹œì € ê²°ê³¼ì˜ ì»¬ëŸ¼ íƒ€ì…ì€ ì˜ˆìƒê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ (DATE â†’ String)
> - ë””ë²„ê¹… ë¡œê·¸ë¡œ ì‹¤ì œ íƒ€ì…/ê°’ í™•ì¸ í•„ìˆ˜
> - N+1 ë¬¸ì œëŠ” í†µí•© ì¿¼ë¦¬/í”„ë¡œì‹œì €ë¡œ í•´ê²°

---

## ğŸ“‹ TODO

- [ ] ë³€ê²½ì‚¬í•­ í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ PR ìƒì„±
- [ ] ì‚­ì œ ê°€ëŠ¥í•œ ê¸°ì¡´ í”„ë¡œì‹œì € ì •ë¦¬
  - `sp_get_weekly_daily_performance`
  - `sp_get_weekly_supplier_aggregation`
  - `sp_get_supplier_period_performance`
  - `sp_get_supplier_daily_slots`

---

## ğŸ“ ë©”ëª¨

- vroong-backend, vroong-front ì–‘ìª½ ìˆ˜ì • í•„ìš”í–ˆë˜ ì‘ì—…
- í”„ë¡ íŠ¸ì—”ë“œ ì—ëŸ¬ ì²˜ë¦¬ ì‹œ ì¸í„°ì…‰í„° ë™ì‘ ë°©ì‹ í™•ì¸ í•„ìˆ˜
- MacroDroid ì„¤ì •: SMS íŠ¸ë¦¬ê±° â†’ HTTP GET ì•¡ì…˜
- í”„ë¡œì‹œì € í†µí•© ì‹œ Multiple Result Sets í™œìš© ê°€ëŠ¥
- N+1 ë¬¸ì œ í•´ê²° ì‹œ JOINìœ¼ë¡œ í†µí•© ì¡°íšŒí•˜ëŠ” ê²ƒì´ íš¨ê³¼ì 
