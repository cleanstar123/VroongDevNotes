# 2026-02-19 ê°œë°œ ì¼ì§€

#daily #vroong #ì •ì‚° #ì¼ì°¨ê°

---

## ðŸ“Š ì˜¤ëŠ˜ ìž‘ì—… ìš”ì•½

| ìž‘ì—… | ìƒíƒœ | ë¶„ë¥˜ |
|------|:----:|------|
| ë¼ì´ë”/í˜‘ë ¥ì‚¬ ì£¼ì •ì‚° ì¼ì°¨ê° ì¤‘ë³µ ì°¨ê° ë°©ì§€ ë° í‘œì‹œ ë¡œì§ ê°œì„  | âœ… | ë°±ì—”ë“œ |
| WORK_DAY íƒ€ìž… ê³µì œ êµì§‘í•© ê¸°ê°„ ì ìš© | âœ… | ë°±ì—”ë“œ |
| DAILY íƒ€ìž… ê³µì œ END_DAY ë¬´ì‹œ ë²„ê·¸ ìˆ˜ì • | âœ… | ë°±ì—”ë“œ |

---

## 1. ì£¼ì •ì‚° ì¼ì°¨ê° í‘œì‹œ ë¡œì§ ë³€ê²½

> [!info] ë°°ê²½
> - ì„ ì •ì‚°ì—ì„œ ì¼ì°¨ê°ì´ ë°œìƒí•˜ë©´ ì£¼ì •ì‚°ì„œì— í•´ë‹¹ ë‚´ì—­ì´ í‘œì‹œë˜ì§€ ì•Šì•˜ìŒ
> - ì‚¬ìš©ìž ìš”ì²­: ì„ ì •ì‚° ì°¨ê° ë‚´ì—­ë„ ì£¼ì •ì‚°ì„œì— ë™ì¼í•˜ê²Œ í‘œì‹œ í•„ìš”

> [!warning] ë¬¸ì œ
> - ê¸°ì¡´: `deductAmt = totalDeductAmt - preDeductVal` (ì°¨ê° í›„ ê¸ˆì•¡ë§Œ í‘œì‹œ)
> - ì„ ì •ì‚° ë¼ì´ë”ì˜ ì£¼ì •ì‚° ì¼ì°¨ê°ì´ 0ì›ìœ¼ë¡œ í‘œì‹œë¨

> [!success] í•´ê²°
> - **í‘œì‹œìš©**: `DEDUCT_AMT = totalDeductAmt` (ì „ì²´ ì¼ì°¨ê° ê¸ˆì•¡)
> - **ê³„ì‚°ìš©**: `actualDeductAmt = totalDeductAmt - preDeductVal` (ì¤‘ë³µ ì°¨ê° ë°©ì§€)
> - `TOT_ACCT_VAL = finalDeliveryVal - preAcctVal - actualDeductAmt`

> [!tip] ë°°ìš´ ì 
> - í‘œì‹œ(Display)ì™€ ê³„ì‚°(Calculation) ë¡œì§ì„ ë¶„ë¦¬í•˜ì—¬ ì²˜ë¦¬

### ìˆ˜ì • ì½”ë“œ (RiderSettlementUseCase.java)
```java
// ì‹¤ì œ ì°¨ê°ì•¡ = ì „ì²´ ì¼ì°¨ê° - ì„ ì •ì‚°ì—ì„œ ì´ë¯¸ ì°¨ê°ëœ ê¸ˆì•¡ (ì¤‘ë³µ ì°¨ê° ë°©ì§€)
BigDecimal actualDeductAmt = totalDeductAmt.subtract(preDeductVal).max(BigDecimal.ZERO);

// ì‹¤ì§€ê¸‰ ë°°ë‹¬ë£Œ = ìµœì¢…ë°°ë‹¬ë£Œ - ì„ ì •ì‚°ë°°ë‹¬ë£Œ - ì‹¤ì œì°¨ê°ì•¡
BigDecimal totAcctVal = calc.finalDeliveryVal.subtract(preAcctVal).subtract(actualDeductAmt);

return RiderSettlement.builder()
    // ...
    .deductAmt(totalDeductAmt)  // í‘œì‹œìš©: ì „ì²´ ì¼ì°¨ê° ê¸ˆì•¡
    .totAcctVal(totAcctVal)     // ê³„ì‚°ì€ ì¤‘ë³µ ë°©ì§€
    .build();
```

---

## 2. DAILY íƒ€ìž… ê³µì œ END_DAY ë¬´ì‹œ ë²„ê·¸ ìˆ˜ì •

> [!info] ë°°ê²½
> - na35176 ë¼ì´ë”: ê³µì œ ê¸°ê°„ 2026-01-29 ~ **2026-02-16**
> - ì •ì‚° ê¸°ê°„: 2026-02-11 ~ 2026-02-17
> - êµì§‘í•©: 2026-02-11 ~ 2026-02-16 (**6ì¼**)

> [!warning] ë¬¸ì œ
> - `calculateEffectiveDays()`ê°€ ê³„ì•½ ì´ë ¥ ê¸°ë°˜ ê°’(7ì¼) ë°˜í™˜
> - ê³µì œ END_DAY(2026-02-16)ê°€ ë¬´ì‹œë˜ì–´ 7ì¼ì¹˜ ì°¨ê°ë¨
> - ê²°ê³¼: 169,785ì› (24,255 Ã— 7ì¼) - **ìž˜ëª»ë¨**

> [!success] í•´ê²°
> - `calculateEffectiveDays()` ëŒ€ì‹  êµì§‘í•© ì¼ìˆ˜ ì§ì ‘ ê³„ì‚°
> - `intersectionDays = ChronoUnit.DAYS.between(effectiveStart, effectiveEnd) + 1`
> - ê²°ê³¼: 145,530ì› (24,255 Ã— 6ì¼) - **ì •ìƒ**

### ìˆ˜ì • ì½”ë“œ
```java
// ë³€ê²½ ì „: ê³„ì•½ ì´ë ¥ ê¸°ë°˜ (êµì§‘í•© ë¬´ì‹œ)
long effectiveDays = calculateEffectiveDays(effectiveStart, effectiveEnd, contEdDate, contractInfo);

// ë³€ê²½ í›„: êµì§‘í•© ê¸°ê°„ ì§ì ‘ ê³„ì‚°
long intersectionDays = ChronoUnit.DAYS.between(effectiveStart, effectiveEnd) + 1;
```

---

## 3. WORK_DAY íƒ€ìž… ê³µì œ êµì§‘í•© ê¸°ê°„ ì ìš©

> [!info] ë°°ê²½
> - WORK_DAY ê³µì œ: ê·¼ë¬´ì¼ì—ë§Œ ì°¨ê° (ë°°ì†¡ ì™„ë£Œ ê±´ì´ ìžˆëŠ” ë‚ )
> - ê³µì œ ê¸°ê°„ê³¼ ì •ì‚° ê¸°ê°„ì˜ êµì§‘í•© ë‚´ ê·¼ë¬´ì¼ìˆ˜ë§Œ ê³„ì‚° í•„ìš”

> [!warning] ë¬¸ì œ
> - ê¸°ì¡´: ì „ì²´ ì •ì‚° ê¸°ê°„ì˜ ê·¼ë¬´ì¼ìˆ˜ ì‚¬ìš© (`workDaysMap`)
> - ê³µì œ ê¸°ê°„ì´ ì •ì‚° ê¸°ê°„ë³´ë‹¤ ì§§ì•„ë„ ì „ì²´ ê·¼ë¬´ì¼ìˆ˜ë¡œ ê³„ì‚°ë¨

> [!success] í•´ê²°
> - êµì§‘í•© ê¸°ê°„ì— ëŒ€í•´ `countWorkDays()` í˜¸ì¶œ
> - `RiderSettlementUseCase.java` ë° `PartnerSettlementUseCase.java` ëª¨ë‘ ìˆ˜ì •

### ìˆ˜ì • ì½”ë“œ
```java
if ("WORK_DAY".equals(deductType)) {
    // êµì§‘í•© ê¸°ê°„ ë‚´ ì‹¤ì œ ê·¼ë¬´ì¼ìˆ˜ ì¡°íšŒ
    int intersectionWorkDays = vrDeliveryListQueryDslRepository.countWorkDays(
        supplyId, riderId,
        effectiveStart.format(DATE_FORMATTER),
        effectiveEnd.format(DATE_FORMATTER));
    totalDeduct = totalDeduct.add(deductAmt.multiply(BigDecimal.valueOf(intersectionWorkDays)));
}
```

---

## ðŸ“ ìˆ˜ì •ëœ íŒŒì¼

| íŒŒì¼ | ìˆ˜ì • ë‚´ìš© |
|------|----------|
| `RiderSettlementUseCase.java` | ì¼ì°¨ê° í‘œì‹œ/ê³„ì‚° ë¶„ë¦¬, DAILY/WORK_DAY êµì§‘í•© ì ìš© |
| `PartnerSettlementUseCase.java` | WORK_DAY êµì§‘í•© ê¸°ê°„ ê·¼ë¬´ì¼ìˆ˜ ì¡°íšŒ |

---

## ðŸ“‹ TODO

- [ ] WORK_DAY íƒ€ìž… ê³µì œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ìž‘ì„±
- [ ] ì •ì‚° ê¸°ê°„ê³¼ ê³µì œ ê¸°ê°„ êµì§‘í•© ì—†ëŠ” ì¼€ì´ìŠ¤ ì—£ì§€ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸

---

## ðŸ“ ë©”ëª¨

### ì¼ì°¨ê° ê³„ì‚° íë¦„
```
1. ê³µì œ ê¸°ê°„ âˆ© ì •ì‚° ê¸°ê°„ = êµì§‘í•© ê¸°ê°„ ê³„ì‚°
2. DAILY: êµì§‘í•© ì¼ìˆ˜ Ã— ì¼ì°¨ê° ê¸ˆì•¡
3. WORK_DAY: êµì§‘í•© ê¸°ê°„ ë‚´ ê·¼ë¬´ì¼ìˆ˜ Ã— ì¼ì°¨ê° ê¸ˆì•¡
4. í‘œì‹œ: totalDeductAmt (ì „ì²´)
5. ê³„ì‚°: actualDeductAmt (ì¤‘ë³µ ì°¨ê° ë°©ì§€)
```

### í…ŒìŠ¤íŠ¸ ì¿¼ë¦¬
```sql
-- êµì§‘í•© ê¸°ê°„ ë‚´ ê·¼ë¬´ì¼ìˆ˜ í™•ì¸
SELECT COUNT(*) AS work_days
FROM vr_delivery_list
WHERE SUPPLY_ID = 'DP2507115380'
  AND RIDER_ID = 'na35176'
  AND DELIVERY_DATE BETWEEN '20260211' AND '20260216'
  AND FINISH_CNT > 0;
```
